<h1 align="center">
  <img src="https://i.ibb.co/YPChnDc/Lista-Rango-2.png" alt="Goomer Lista Rango API" width="260"/>
</h1>

# üç¥ Goomer Lista Rango API üç¥

> API RESTful capaz de gerenciar os restaurantes e os produtos do seu card√°pio.

- [Tecnologias](#Tecnologias)
- [Desafios](#Desafios)
- [Melhorias](#Melhorias)
- [Arquitetura](#Arquitetura)
- [Instala√ß√£o](#Instala√ß√£o)
- [Testes](#Testes)

**Demo:** https://goomer-lista-rango.ribeirogab.me

# Tecnologias

Linguagens e ferramentas:

- [Node.js](https://nodejs.org/);
- [TypeScript](https://www.typescriptlang.org/).

Banco de Dados:

- [PostgreSQL](https://www.postgresql.org/);

Testes unit√°rios:

- [Jest](https://jestjs.io/).

Cache:

- [Redis](https://redis.io/).

Padroniza√ß√£o de c√≥digo/commits:

- [ESLint](https://eslint.org/);
- [Prettier](https://prettier.io/);
- [Commitizen](https://github.com/commitizen/cz-cli).

Ambiente

- [Docker](https://docs.docker.com/);
- [Docker Compose](https://docs.docker.com/compose/).

# Desafios

Trabalhar sem ter um ``ORM``. Ter que relembrar e escrever SQL puro, aprender como fazer agrega√ß√µes no PostgreSQL e criar uma arquitetura pr√≥pria de rela√ß√£o entre as ``entities`` do projeto com certeza foi o maior desafio.

Outro desafio foi escrever primeiramente todos os testes unit√°rios da aplica√ß√£o com os reposit√≥rios fakes para somente ap√≥s isso criar e implementar os reposit√≥rios do PostgreSQL. Est√° decis√£o foi tomada pelo fato de ter que criar toda a l√≥gica no SQL manualmente, implementar essas l√≥gicas primeiramente nos testes ajudaram bastante na cria√ß√£o dos reposit√≥rios do PostgreSQL.

# Melhorias

**Testes de integra√ß√£o:**

Os testes de integra√ß√£o s√£o mais que necess√°rios nesta e em qualquer aplica√ß√£o que visa escalabilidade e confiabilidade.

---

**Tabela de indisponibilidade:**

Criar uma tabela de indisponibilidade no banco de dados para que os restaurantes consigam cadastrar um hor√°rio que estar√£o ausentes. Por exemplo:

Um restaurante trabalha das 11:00 √†s 17:00 de segunda √† sexta, por√©m, em uma semana espec√≠fica ele funcionar√° das 11:00 √†s 15:00 na segunda-feira (os outros dias continuam normais), por conta de algum compromisso/imprevisto ou qualquer outra coisa. Tendo uma tabela de indisponibilidade, o restaurante poder√° cadastrar exatamente o per√≠odo que estar√° indispon√≠vel, sem precisar alterar o seu hor√°rio de trabalho fixo.

---

**Implementar um ORM:**

Apesar da aplica√ß√£o estar relativamente organizada, um ``ORM`` seria de grande ajuda principalmente para deixar o c√≥digo mais leg√≠vel e manuten√≠vel, retirando toda a complexidade do SQL do reposit√≥rio.

Op√ß√µes de ORM:

- Sequelize;
- TypeORM.

---

**API de c√≥digos postais:**

Atualmente a API possui um ``provider`` de c√≥digo postais com duas implementa√ß√µes:

- Brasil API;
- Postmon.

Por√©m essas APIs fornecem apenas c√≥digos postais (CEP) do Brasil, sendo assim, a aplica√ß√£o ficaria limitada a somente o Brasil. (dependendo do objetivo da aplica√ß√£o isso n√£o √© um problema)

Poss√≠veis solu√ß√µes:

- Habilitar todos os campos de endere√ßo diretamente na rota;
- Utilizar uma API de c√≥digos postais global.

---

**API KEY:**

Como a API n√£o tem nenhuma forma de autentica√ß√£o e todas as rotas s√£o p√∫blicas, uma boa solu√ß√£o seria criar uma API KEY para cada client que utilizasse-a.

---

**Excluir promo√ß√£o quando acabar:**

Quando um produto √© colocado em promo√ß√£o temos a data/hora de in√≠cio e t√©rmino, sendo assim, ap√≥s o fim da promo√ß√£o o registro poderia ser exclu√≠do do banco de dados e o campo de promo√ß√£o na listagem de produtos ser setado como ``null``.

---

# Arquitetura

O projeto foi constru√≠do em cima da arquitetura Domain-Driven Design ou Projeto Orientado a Dom√≠nio (famoso DDD) que √© um padr√£o de modelagem orientado a objetos (m√≥dulos).

## Arquitetura global

```shell
src/
|-- config/ # Cont√©m os arquivos de configura√ß√£o, exemplo: dotenv, cache e upload.
|-- modules/ # Cont√©m os m√≥dulos (ou objetos) da aplica√ß√£o.
|-- shared/ # Arquivos compartilhados (globais), exemplo: server, errors e container de inje√ß√£o de depend√™ncia.
|-- swagger.json # Apenas a documenta√ß√£o
```

## Arquitetura dos m√≥dulos

```shell
{module}/
|-- infra/ # Cont√©m as rotas, controllers e implementa√ß√µes de reposit√≥rios
|-- models/ # Cont√©m o modelo (ou estrutura) de dados do m√≥dulo
|-- providers/ # Arquivos dos reposit√≥rios e providers do m√≥dulo para serem "injetados" no container de inje√ß√£o de depend√™ncia
|-- repositories/ # Modelo de dados, DTOs e fakes dos reposit√≥rios do m√≥dulo
|-- services/ # Servi√ßos ou regra de neg√≥cio da aplica√ß√£o
```

# Banco de dados

O banco de dados utilizado no projeto foi o PostgreSQL, mais por quest√£o de familiaridade do que alguma outra raz√£o espec√≠fica.

**Modelo (DER):**

<img src="https://i.ibb.co/4mFyy6f/Goomer-Lista-Rango-2x-8.png" alt="DER" width="800"/>

- [SQL de cria√ß√£o do banco](https://github.com/ribeirogab/goomer-lista-rango/blob/main/src/shared/infra/databases/postgreSQL/init.sql)

# Instala√ß√£o

```sh
git clone https://github.com/ribeirogab/goomer-lista-rango
```

```sh
cd goomer-lista-rango
```

```sh
yarn
```

## Rodando o projeto

Para rodar essa aplica√ß√£o localmente voc√™ pode seguir uma das tr√™s op√ß√µes descritas a seguir.

Op√ß√µes:

- [Docker Compose](#docker-compose-recomendada); (Recomendada)
- Manualmente;
- Docker run.

## Docker Compose (Recomendada)

**Requisitos:**

- [Docker](https://docs.docker.com/engine/install/) vers√£o 20.10.2 ou superior;
- [Docker Compose](https://docs.docker.com/compose/install/) vers√£o 1.29.2 ou superior.

---

**Desenvolvimento:**

Ap√≥s clonar o projeto e instalar as depend√™ncias, execute o seguinte comando para rodar a aplica√ß√£o:

```sh
docker-compose up
```

> Ap√≥s os containers subirem, a aplica√ß√£o estar√° dispon√≠vel em [http://localhost:3333/](http://localhost:3333/)

---

**Production ready:**

Para executar o projeto em produ√ß√£o, ser√° necess√°rio criar um arquivo ``.env`` na raiz do projeto e preenche-lo, caso seja apenas um teste, basta copiar os valores de ``.env.dev``.

Com o ``.env`` criado e preenchido, rode o seguinte comando:

```sh
docker-compose -f docker-compose.yml up
```

## Manualmente

**Requisitos:**

- [Docker](https://docs.docker.com/engine/install/) vers√£o 20.10.2 ou superior;
- [Node.js](https://nodejs.org/) vers√£o 14.17.2 ou superior.
- [Yarn](https://yarnpkg.com/) vers√£o 1.22.10 ou superior.

## Docker run

**Requisitos:**

- [Docker](https://docs.docker.com/engine/install/) vers√£o 20.10.2 ou superior;

# Testes

## Testes unit√°rios

Com a aplica√ß√£o clonada e as depend√™ncias instaladas, para rodar os testes unit√°rios execute o seguinte comando:

```sh
yarn test
```

**Cobertura:**

<img src="https://i.ibb.co/Mpn9mVj/Screenshot-20210719-153306.png" alt="Cobertura dos testes" width="480"/>

Para visualizar a cobertura dos testes de uma maneira mais intu√≠tiva, acesse o diret√≥rio ``goomer-lista-rango/coverage/lcov-report``.

Esta pasta possu√≠ um arquivo ``√¨ndex.html``, que ao ser aberto exibir√° a cobertura de todos os testes.
